configPatches:
- applyTo: NETWORK_FILTER
  match:
    context: GATEWAY
    listener:
      filterChain:
        sni: api.test.garden.s.testseed.dev.ske.eu01.stackit.cloud
  patch:
    operation: INSERT_FIRST
    value:
      name: acl-api
      typed_config:
        '@type': type.googleapis.com/envoy.extensions.filters.network.rbac.v3.RBAC
        rules:
          action: DENY
          policies:
            acl-api:
              permissions:
              - any: true
              principals:
              - source_ip:
                  address_prefix: 0.0.0.0
                  prefix_len: 0
        stat_prefix: envoyrbac
- applyTo: HTTP_FILTER
  match:
    context: GATEWAY
    listener:
      name: 0.0.0.0_8132
  patch:
    operation: INSERT_FIRST
    value:
      name: acl-vpn
      typed_config:
        '@type': type.googleapis.com/envoy.extensions.filters.http.rbac.v3.RBAC
        rules:
          action: DENY
          policies:
            acl-vpn:
              permissions:
              - any: true
              principals:
              - and_ids:
                  ids:
                  - source_ip:
                      address_prefix: 0.0.0.0
                      prefix_len: 0
                  - header:
                      name: reversed-vpn
                      string_match:
                        contains: test
        stat_prefix: envoyrbac
workloadSelector:
  labels:
    app: istio-ingressgateway
    istio: ingressgateway